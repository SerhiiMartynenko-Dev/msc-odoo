<?xml version="1.0" encoding="utf-8"?>
<odoo>



    <record id="view_order_form" model="ir.ui.view">
        <field name="name">sale.order.form.inherit.msc</field>
        <field name="model">sale.order</field>
        <field name="inherit_id" ref="sale.view_order_form" />
        <field name="priority" eval="999" />
        <field name="arch" type="xml">
            <header position="inside">
                <button type="object" name="action_set_discount"
                        attrs="{'invisible': [('state', '=', 'cancel')]}"
                        string="Set Discount" class="btn-primary" />
                <button type="object" name="action_print_receipt"
                        attrs="{'invisible': [('state', '=', 'cancel')]}"
                        confirm="Are you sure that you want to confirm order and print receipt?"
                        string="Print Receipt" class="btn-success" />
            </header>


            <xpath expr="//field[@name='amount_total']" position="after">
                <field name="amount_stock_cost" />
            </xpath>


            <xpath expr="//field[@name='order_line']/form//div[@name='discount']" position="after">
                <field name="discount_price" groups="product.group_discount_per_so_line" />
            </xpath>
            <xpath expr="//field[@name='order_line']/tree//field[@name='discount']" position="after">
                <field name="discount_price" optional="show" groups="product.group_discount_per_so_line" />
            </xpath>
            <xpath expr="//field[@name='order_line']/tree//field[@name='margin']" position="before">
                <field name="stock_cost" optional="hide" />
            </xpath>



            <field name="amount_untaxed" position="before">
                <field name="total_units" />
                <div class="oe_subtotal_footer_separator oe_inline o_td_label">
                    <label for="amount_untaxed" />
                </div>
            </field>
            <field name="amount_untaxed" position="attributes">
                <attribute name="nolabel">1</attribute>
            </field>
        </field>
    </record>








    <!--
        Hide margin and cost
    -->

    <record id="view_order_form_sale_user" model="ir.ui.view">
        <field name="name">sale.order.form.inherit.msc.sale_user</field>
        <field name="model">sale.order</field>
        <field name="inherit_id" ref="sale.view_order_form"/>
        <field name="priority" eval="99999" />
        <field name="groups_id" eval="[(6, 0, [ref('msc.group_msc_sale_user')])]" />
        <field name="mode">extension</field>
        <field name="arch" type="xml">
            <xpath expr="//group[@name='note_group']//field[@name='amount_stock_cost']" position="replace"/>
            <xpath expr="//group[@name='note_group']//label[@for='margin']" position="replace"/>
            <xpath expr="//group[@name='note_group']//field[@name='margin']/.." position="replace"/>

            <xpath expr="//field[@name='order_line']/form//field[@name='purchase_price']" position="replace" />
            <xpath expr="//field[@name='order_line']/tree//field[@name='purchase_price']" position="replace" />
            <xpath expr="//field[@name='order_line']/tree//field[@name='stock_cost']" position="replace" />
            <xpath expr="//field[@name='order_line']/tree//field[@name='margin']" position="replace" />
            <xpath expr="//field[@name='order_line']/tree//field[@name='margin_percent']" position="replace" />
        </field>
    </record>


    <record id="view_sale_order_pivot" model="ir.ui.view">
        <field name="name">sale.order.pivot.inherit.msc.sale_user</field>
        <field name="model">sale.order</field>
        <field name="inherit_id" ref="sale.view_sale_order_pivot"/>
        <field name="priority" eval="99999" />
        <field name="groups_id" eval="[(6, 0, [ref('msc.group_msc_sale_user')])]" />
        <field name="mode">extension</field>
        <field name="arch" type="xml">
            <pivot position="inside">
                <field name="margin" invisible="1" />
                <field name="margin_percent" invisible="1" />
            </pivot>
        </field>
    </record>

    
    <record id="view_sale_order_graph" model="ir.ui.view">
        <field name="name">sale.order.graph.inherit.msc.sale_user</field>
        <field name="model">sale.order</field>
        <field name="inherit_id" ref="sale.view_sale_order_graph"/>
        <field name="priority" eval="99999" />
        <field name="groups_id" eval="[(6, 0, [ref('msc.group_msc_sale_user')])]" />
        <field name="mode">extension</field>
        <field name="arch" type="xml">
            <graph position="inside">
                <field name="margin" invisible="1" />
                <field name="margin_percent" invisible="1" />
            </graph>
        </field>
    </record>



</odoo>
